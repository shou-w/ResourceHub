# 実装方法と構成に関する説明資料
## 概要
* 製品化に向けて実装方法、構成を決めていく必要がある
* 決定をする上で、現在の状況と将来性的な要素を考慮する必要がある
* 決定した選択のメリットデメリットを明らかにし、なぜその選択をしたのか、理由も明らかにしたうえで、デメリットをどのようにして補うかを明確にする必要がある

## 状況説明
### AIプロジェクトについて
* まず既存のシステムとしてファイルサーバーがある
* ファイルサーバーしすてむはAIとは全く関係なく、独立したシステム
* AIプロジェクトはAIチャットボットと要約機能を実装する
* AIプロジェクトで実装するAIチャットボットと要約機能はAPIであり、ファイルサーバーシステムにUIを実装し、そこからコールする
* AIチャットボットは、ファイルサーバーの特定のフォルダに置かれているファイルを対象にAIチャットボットが構築できる
* 要約機能は、ファイルサーバーに置かれているファイルをAIで要約する

### プロトタイプについて
* すでにプロトタイプを実装済み
* 構成は以下のようになっている
  * LLM Service : OpenAI API と連携する役割
  * DB Management Service : ファイルサーバーから送られてくるファイルを読み取り、チャンキングし、エンベディングする。また、更新、削除、ベクトル検索も行う
  * Chatbot Service : ファイルサーバーから送られてくるチャットメッセージを DB Management Service や LLM Service と連携することで、回答を生成する
  * Summary Service : ファイルサーバーから送られてくるファイルの内容を LLM Service と連携し要約する
* DB は pgvector を使う
* これらはそれぞれのコンテナに分かれており、マイクロサービスとして構成されている
* コンテナ管理は docker compose を使っている

### その他の情報
* リリース日まであまり時間がない
* Kubernetes の知見がなく、また、docker コンテナの本番運用の実績もないため、マイクロサービスは難しいと考えている
* ファイルサーバーシステムは、クラウドとアプライアンス提供の２種類がある
* クラウド環境はユーザーごとにＶＭでわかれている
* アプライアンス版は、Ubuntu 版と CentOS7 版がある
* CentOS7 版は、ＯＳのサポートが切れているので、コンテナ化して、そこで Ubuntu にしようと計画を立てている
* docker compose についての知見をもっているメンバーはいる
* Kubernetes については調査中で、将来的には使う予定、現時点では難しい
* 将来的にファイルサーバーシステムもマイクロサービス化を検討中
* ファイルサーバーシステムのDBは postgresql
* ファイルサーバーとAIシステムは完全に別物
* 現時点でも将来的にもファイルサーバーとAIシステムが同じコンテナに入ることはなく、同じDBを使うこともない

### 検討事項
* Kubernetes は現時点では使えないので、マイクロサービスであるメリットを得られないと考えているため、モジュラモノリスに移行を考えている
* モジュラモノリスはAIチャットボットと要約機能の同時実装が可能だと考えている
* モジュール間がＡＰＩ通信でなくなるためレイテンシが改善されると考えている
* モジュラモノリスにする際に、将来的なマイクロサービスを考慮した実装を検討中。つまり、APIの部分を残しつつ、将来的に移行することを意識したもの。ソースコードは少し複雑化してしまう。
* 将来的なマイクロサービスを意識する理由としては、チャットボットの場合、アクセス数が多くなることも考えられるので、スケーラビリティを考える必要があると思っている
* マイクロサービスへの以降は、Kubernetes などの知見がたまり検証ができてから
* 本番環境でのコンテナ運用の経験がないので、コンテナ数はなるべく減らす必要があるかもしれない
* マイクロサービスを考慮したモジュラモノリスを実装して、将来的に移行しなかった場合、複雑なソースコードというものが残ってしまい、結局リファクタリングにリソースをとられる
* 純粋なモジュラモノリスの場合、将来的にマイクロサービスへ移行するとしてもモノリスよりは移行しやすい。ただし、それなりにリソースはかかる
* ファイルサーバーの DB が postgresql なので、pgvector の影響を受けるかもしれないので、AIプロジェクト側はなるべくコンテナ化をしたほうがいいのではないかと考えている

### 寄せられた意見など
* なぜ将来的なマイクロサービスを考える必要があるのか
* マイクロサービスは必要なのか
* いま決断できることなのか
* なぜコンテナ化が必要なのか
* アプリケーションとDBはコンテナを分ける必要があるのか、一緒にしたほうがパフォーマンスが上がるのではないか

---

# プロンプト
```markdown
「実装方法と構成に関する説明資料」の内容を基に、以下の指示にしたがってください。

# 指示
以下の２点について決める必要がある。
* 将来的なマイクロサービスを考慮したモジュラモノリスにするのか、考慮せずに純粋なモジュラモノリスにすべきなのか決める
* アプリケーションとDBなどのコンテナを一緒にすべきか分けるべきか決める

その際、以下の点を考慮する必要がある。

* 今の状況と将来的な要素を切り分ける
* コンテナの本番運用の経験がないことを考慮する必要がある
* どの選択するにせよメリットデメリットをあげる
* デメリットがあってもそれを選択する理由
* なぜその選択をしたのか、すべきなのかの根拠を明らかにし説得できるようにする
```